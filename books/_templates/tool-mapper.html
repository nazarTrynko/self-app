<!--
    TOOL TEMPLATE: MAPPER
    Purpose: Visualize current state through user inputs
    Time: 60-90 seconds
    Pattern: Multiple inputs → Visual map/diagram output
    
    Example: Transition Map (Before → Now → After)
-->

<div class="tool-mapper" id="{{TOOL_ID}}">
    <div class="tool-header">
        <span class="tool-label">{{TOOL_LABEL}}</span>
        <h3 class="tool-title">{{TOOL_TITLE}}</h3>
        <p class="tool-description">{{TOOL_DESCRIPTION}}</p>
    </div>

    <!-- Input Form -->
    <form class="mapper-form" id="{{TOOL_ID}}Form">
        <div class="mapper-inputs">
            <!-- Node 1 -->
            <div class="mapper-input-group">
                <label class="input-label">{{NODE_1_LABEL}}</label>
                <textarea 
                    class="input-textarea" 
                    id="{{TOOL_ID}}_node1" 
                    placeholder="{{NODE_1_PLACEHOLDER}}"
                    rows="3"
                ></textarea>
            </div>

            <!-- Node 2 -->
            <div class="mapper-input-group">
                <label class="input-label">{{NODE_2_LABEL}}</label>
                <textarea 
                    class="input-textarea" 
                    id="{{TOOL_ID}}_node2" 
                    placeholder="{{NODE_2_PLACEHOLDER}}"
                    rows="3"
                ></textarea>
            </div>

            <!-- Node 3 -->
            <div class="mapper-input-group">
                <label class="input-label">{{NODE_3_LABEL}}</label>
                <textarea 
                    class="input-textarea" 
                    id="{{TOOL_ID}}_node3" 
                    placeholder="{{NODE_3_PLACEHOLDER}}"
                    rows="3"
                ></textarea>
            </div>
        </div>

        <button type="submit" class="tool-submit">{{SUBMIT_TEXT}}</button>
    </form>

    <!-- Visual Map Output -->
    <div class="mapper-results hidden" id="{{TOOL_ID}}Results">
        <div class="results-header">
            <h4>{{RESULTS_TITLE}}</h4>
            <div class="results-actions">
                <button class="action-btn" onclick="copyMapperResults('{{TOOL_ID}}')" title="Copy">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Visual Map -->
        <div class="mapper-visual">
            <div class="map-node" id="{{TOOL_ID}}_display1">
                <span class="node-label">{{NODE_1_LABEL}}</span>
                <p class="node-content"></p>
            </div>
            <div class="map-arrow">→</div>
            <div class="map-node" id="{{TOOL_ID}}_display2">
                <span class="node-label">{{NODE_2_LABEL}}</span>
                <p class="node-content"></p>
            </div>
            <div class="map-arrow">→</div>
            <div class="map-node" id="{{TOOL_ID}}_display3">
                <span class="node-label">{{NODE_3_LABEL}}</span>
                <p class="node-content"></p>
            </div>
        </div>

        <!-- Insights Grid -->
        <div class="mapper-insights" id="{{TOOL_ID}}Insights">
            <!-- Dynamic insights inserted here -->
        </div>
    </div>
</div>

<style>
    .tool-mapper {
        max-width: 900px;
        margin: 0 auto;
    }

    .tool-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .tool-label {
        display: inline-block;
        font-size: 0.7rem;
        font-weight: 500;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--accent-primary, #d4a574);
        margin-bottom: 0.5rem;
    }

    .tool-title {
        font-family: var(--font-display, Georgia, serif);
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }

    .tool-description {
        color: var(--text-secondary, #a8a29e);
        font-size: 0.95rem;
    }

    .mapper-form {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .mapper-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .mapper-input-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .input-label {
        font-size: 0.8rem;
        font-weight: 500;
        letter-spacing: 0.05em;
        color: var(--text-secondary, #a8a29e);
    }

    .input-textarea {
        padding: 1rem;
        background: var(--bg-input, #0d0c0a);
        border: 1px solid var(--border-subtle, rgba(168, 162, 158, 0.12));
        color: var(--text-primary, #faf9f7);
        font-family: inherit;
        font-size: 0.95rem;
        resize: vertical;
        transition: border-color 0.2s;
    }

    .input-textarea:focus {
        outline: none;
        border-color: var(--accent-primary, #d4a574);
    }

    .tool-submit {
        padding: 1rem 2rem;
        background: var(--accent-primary, #d4a574);
        color: var(--bg-void, #0a0908);
        font-family: inherit;
        font-size: 0.9rem;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
    }

    .tool-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 40px rgba(212, 165, 116, 0.2);
    }

    /* Results */
    .mapper-results {
        margin-top: 2rem;
        animation: fadeIn 0.4s ease;
    }

    .mapper-results.hidden {
        display: none;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-subtle, rgba(168, 162, 158, 0.12));
    }

    .results-header h4 {
        font-family: var(--font-display, Georgia, serif);
        font-size: 1.25rem;
    }

    .action-btn {
        padding: 0.5rem;
        background: transparent;
        border: 1px solid var(--border-subtle, rgba(168, 162, 158, 0.12));
        color: var(--text-secondary, #a8a29e);
        cursor: pointer;
        transition: all 0.2s;
    }

    .action-btn:hover {
        border-color: var(--accent-primary, #d4a574);
        color: var(--accent-primary, #d4a574);
    }

    /* Visual Map */
    .mapper-visual {
        display: grid;
        grid-template-columns: 1fr auto 1fr auto 1fr;
        align-items: center;
        gap: 1rem;
        padding: 1.5rem;
        background: var(--bg-input, #0d0c0a);
        border: 1px solid var(--border-subtle, rgba(168, 162, 158, 0.12));
        margin-bottom: 1.5rem;
    }

    .map-node {
        text-align: center;
        padding: 1rem;
    }

    .node-label {
        display: block;
        font-size: 0.7rem;
        font-weight: 500;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--text-muted, #78716c);
        margin-bottom: 0.5rem;
    }

    .node-content {
        font-family: var(--font-display, Georgia, serif);
        font-size: 0.95rem;
        color: var(--text-primary, #faf9f7);
    }

    .map-arrow {
        color: var(--accent-primary, #d4a574);
        font-size: 1.5rem;
    }

    /* Insights Grid */
    .mapper-insights {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
    }

    .insight-card {
        padding: 1.25rem;
        background: var(--bg-input, #0d0c0a);
        border: 1px solid var(--border-subtle, rgba(168, 162, 158, 0.12));
        border-left: 3px solid var(--card-accent, var(--accent-primary));
    }

    .insight-card h5 {
        font-size: 0.7rem;
        font-weight: 500;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--text-muted, #78716c);
        margin-bottom: 0.5rem;
    }

    .insight-card p {
        font-size: 0.9rem;
        color: var(--text-primary, #faf9f7);
        line-height: 1.5;
    }

    /* Card color variations */
    .insight-card.losses { --card-accent: #e11d48; }
    .insight-card.gains { --card-accent: #10b981; }
    .insight-card.constraints { --card-accent: #f59e0b; }
    .insight-card.signals { --card-accent: #8b5cf6; }
    .insight-card.next { --card-accent: var(--accent-primary, #d4a574); }

    /* Responsive */
    @media (max-width: 700px) {
        .mapper-visual {
            grid-template-columns: 1fr;
            text-align: center;
        }
        
        .map-arrow {
            transform: rotate(90deg);
        }
    }
</style>

<script>
// Mapper Tool Logic
(function() {
    const toolId = '{{TOOL_ID}}';
    const form = document.getElementById(`${toolId}Form`);
    const results = document.getElementById(`${toolId}Results`);

    if (!form) return;

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        // Get inputs
        const node1 = document.getElementById(`${toolId}_node1`).value.trim();
        const node2 = document.getElementById(`${toolId}_node2`).value.trim();
        const node3 = document.getElementById(`${toolId}_node3`).value.trim();

        // Validate
        if (!node1 || !node2 || !node3) {
            alert('Please fill in all three fields');
            return;
        }

        // Track
        if (typeof track === 'function') {
            track('tool_mapper_submit', { tool: toolId });
        }

        // Display map
        displayMap(node1, node2, node3);

        // Generate insights
        const insights = generateInsights(node1, node2, node3);
        displayInsights(insights);

        // Show results
        results.classList.remove('hidden');

        // Scroll to results
        results.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    function displayMap(node1, node2, node3) {
        const truncate = (str, len = 60) => 
            str.length <= len ? str : str.substring(0, len) + '...';

        document.querySelector(`#${toolId}_display1 .node-content`).textContent = truncate(node1);
        document.querySelector(`#${toolId}_display2 .node-content`).textContent = truncate(node2);
        document.querySelector(`#${toolId}_display3 .node-content`).textContent = truncate(node3);
    }

    function generateInsights(node1, node2, node3) {
        // CUSTOMIZE: Replace with your synthesis-specific insight logic
        return {
            losses: "What you're leaving behind made sense for who you were. It doesn't have to make sense now.",
            gains: "In the uncertainty, you're developing tolerance for ambiguity—a rare skill.",
            constraints: "The thing holding you back might be protecting something important.",
            signals: "Your future self is already pulling you forward. Listen to the pull.",
            next: "Write one sentence about who you're becoming. Read it aloud every morning."
        };
    }

    function displayInsights(insights) {
        const container = document.getElementById(`${toolId}Insights`);
        container.innerHTML = `
            <div class="insight-card losses">
                <h5>What You're Releasing</h5>
                <p>${insights.losses}</p>
            </div>
            <div class="insight-card gains">
                <h5>What You're Gaining</h5>
                <p>${insights.gains}</p>
            </div>
            <div class="insight-card constraints">
                <h5>What's Holding You</h5>
                <p>${insights.constraints}</p>
            </div>
            <div class="insight-card signals">
                <h5>What's Calling You</h5>
                <p>${insights.signals}</p>
            </div>
            <div class="insight-card next">
                <h5>Your Next Move</h5>
                <p>${insights.next}</p>
            </div>
        `;
    }

    // Copy function
    window.copyMapperResults = function(id) {
        const node1 = document.getElementById(`${id}_node1`).value;
        const node2 = document.getElementById(`${id}_node2`).value;
        const node3 = document.getElementById(`${id}_node3`).value;

        const text = `MY TRANSITION MAP

BEFORE: ${node1}

NOW: ${node2}

AFTER: ${node3}

---
Created with The Synthesis Universe`;

        navigator.clipboard.writeText(text).then(() => {
            alert('Copied to clipboard!');
        });
    };
})();
</script>


